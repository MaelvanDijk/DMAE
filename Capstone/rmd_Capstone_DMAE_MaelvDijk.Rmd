---
title: "Capstone_MaelvDijk_DMaE"
author: "Maël"
date: '2022-03-15'
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library("tidyverse")
library("stringr")

#custom functions
source('./supporting_code/Scraped_indeed_data_wrangler.R')
source('./supporting_code/Scraped_indeed_plotter.R')
source('./supporting_code/Kaggle_indeed_plotter.R')
```

# Inleiding

In dit capstone project wordt de ontwikkeling naar de vraag van
hardskills en rollen binnen het data domein onderzocht. Het project is
ontsprongen naar aanleiding van een gerelateerde vraag vanuit House of
Bèta. Bij aanvang van dit project was de wens een onderzoek te doen naar
drivers en kenmerken van uitstroom van onze consultants. Wegens
juridische beperkingen en het hier uit volgende tijdsgebrek is gekozen
voor het onderzoeken van een alternatieve vraag, namelijk: **"Hoe
ontwikkelt de vraag naar 'data specialisten' zich kijkende naar de
gevraagde vaardigheden en het geboden loon"**.

Deze nieuw geformuleerde vraag helpt deels de originele vraag te
beantwoorden. De resultaten kunnen namelijk dienen als benchmarks voor
het geboden loon en ondersteunen in het samenstellen van een (deel van)
het arbeidsvoorwaarden pakket. Een derde belang is het peilen van de
vraag naar "data personeel" en de daarbijhorende opdrachtgevers.

## Business understanding

### House of Bèta

House of Bèta (HoB) is een detacheerder en consultancy op het gebied van
business IT. Er zijn diverse specialisatie richtingen waartussen een
consultant kan kiezen. HoB richt zich op starters op de arbeidsmarkt en
staat open voor consultants met en zonder formele IT opleiding. Naast
het matchen tussen vraag en aanbod van consultants en opdrachtgevers
zorgt HoB voor een breed aanbod aan opleidingen zodat consultants zich
kunnen blijven ontwikkelen op het gebied van hard-, en softskills. Een
consultancy staat of valt met de expertise en kennis van haar
medewerkers, dit maakt retentie van medewerkers belangrijk. De uitstroom
van HoB's zusterbedrijf Talent&Pro in 2021 is aanleiding voor HoB om
hier meer grip op te krijgen. Na een kort voor onderzoek is gebleken dat
met de beschikbare tijd en midellen de uitstroom analyseren en
potentiëel voorspellen nog niet mogelijk is. Hierop is voorgesteld om
naar de vacature ontwikkeling te kijken. Deze analyse kan een bijdragen
leveren aan het onderzoek omtrent uitstroom, daarnaast geeft het HoB de
mogelijkheid om haar huidige compensatie aan medewerkers op waarde te
schatten.

### Businessvraag

De vraag die bij de business ligt: **"Hoe ontwikkelt de vraag naar 'data
specialisten'in Nederland zich kijkende naar de gevraagde vaardigheden,
het geboden loon en mogelijke opdrachtgevers?"** komt vanuit de
commercieel directeur van HoB. Het probleemgebied heeft betrekking op:
commercie, businessdevelopement en HR. Dit maakt dat de uiteindelijke
inzichten op meer plekken in de organisatie gedragen zal worden.

Om deze vraag te beantwoorden moeten er een aantal deelvragen beantwoord
worden: 1. Hoe ontwikkelt de vraag naar individuele skills zich? 2. Hoe
verhoudt de kennis breedte (aantal skills) zich tot de loon en
rolverdeling? 3. In welke zit de grootste vraag (ontwikkeling)?

### data gebruik

Er vinden nog geen datamining activiteiten plaats binnen HoB. Naast de
analyse wordt er dan ook een stuk code geleverd om een vacatures te
minen. Dit kan vrij door HoB gebruikt worden indien gewenst. Omdat voor
dit capstone project de tijd beperkt is zijn er een aantal keuzes
gemaakt m.b.t de data en het minen hier van: 1. Voor vacatures wordt
alleen data van Indeed gebruikt 2. De vacatures zijn beschikbaar vanaf 8
februari 2022 3. Als referentie dataset voor benodigde (hard)skills
wordt de [Indeed dataset van
Kaggle](https://www.kaggle.com/elroyggj/indeed-dataset-data-scientistanalystengineer)
gebruikt.

### Business Success criteria

Kwantitatieve doelstelling voor het beantwoorden van deze vraag is niet
direct mogelijk. Daarom wordt er gekeken naar kwalitatieve eisen.
Minimaal wordt er een inkomens benchmark verwacht en een indicatie van
de hoeveelheid vraag bij bedrijven. Een bijkomende wens is om het
arbeidsvoorwaardenpakket op waarden te kunnen schatten. Dit is een
uitdaging waar nog niet duidelijk van is of dit gaat lukken.

## Data understanding

In dit hoofdstuk wordt gekeken naar de locatie en de basis kenmerken van
de data. Zoals in business understanding gesteld wordt gebruik gemaakt
van de [indeed dataset van
Kaggle](https://www.kaggle.com/elroyggj/indeed-dataset-data-scientistanalystengineer)
en gescrapte indeed data.

Onderstaande datalog geeft een beeld van de gebruikte ruwe data (te
vinden in *.\\Data_raw*):

| ID   | dataset name                   | format | beschrijving                                                                         | dataset owner |
|---------------|---------------|---------------|---------------|---------------|
| D001 | indeed_job_dataset.csv         | CSV    | dataset met job post data vanuit de VS voor data anlysten, scientisten en engineers. | Elroy         |
| D002 | <DATE> scraped indeed data.csv | CSV    | scraped data voor functies met het woord "data" in nederland                         | Maël          |

: datalog (shortened)

Deze datasets worden gebruikt door de analyse heen. D001 is gedownload
van kaggle.com, D002 is gescraped door gebruik te maken van de
**indeed_scraper** te vinden in *.\\suporting_code*

### data scope

Bij een eerste verkenning van de mogelijke datasets zijn meerdere opties
geconstateerd om aan data te komen, nameijk: gebruik makend van een API,
downloaden van voor bewerkte datasets, zelf scrapen van data.

Aangezien de voor bewerkte datasets veelal van toepassing zijn op de
amerikaanse markt of beperkte rijen hebben met data vacatures is er voor
gekozen deze datasets niet te gebruiken (buiten de D001).

Wat betreft de API's bleken deze veelal niet meer werkzaam of betaald te
zijn, deze optie viel daarom na enkele tests af.

het zelf scrapen van Indeed data is de overgebleven optie. Dit helpt met
de scope voor het project te bepalen (data vacatures in Nederland) en
brengt gelijk een beperking mee. Indeed heeft namelijk 3 leeftijds
benaming voor vacatures ("vandaag", 1 t/m 30 dagen geleden, "+ 30 dagen
geleden"). Om deze reden kan er vanaf de eerste scrape maar 30 dagen
terug gekeken worden (dus 8 februari 2022).

### Basale data beschrijving

Hieronder worden beide datasets hoogover beschreven. Voor dataset D002
worden de kenmerken van een enkele file beschreven, de aannamen is dat
de kenmerken tussen de files redelijk overeenkomen. Uiteraard kunnen
NaN's, ranges, unique's etc. wat verschillen. Dit zal echter in de
uiteindelijke data modeling worden recht gezet

**D001:**

Deze dataset bestaat uit:

-   5.715 rijen

-   43 kolommen

-   Een aantal kolommen zoals states die minder relevant lijken voor het
    onderwerp

-   De skills kolom bevat naar verwachting de belanrijkste data in de
    vorm van lijsten van 1 of meer gevraagde skills

-   Voor de vacatures worden gemiddeld 7 a 8 skills gevraagd, minimaal 0
    en maximaal 20

-   De de job_title kolom bevat 2.314 titels die vertaald worden naar 1
    van de 3 job_types

-   Er zijn 3 job_types in deze dataset aanwezig, Data Analyst, Data
    Engineer en Data Scientist

-   De salaris kolom bevat 6 salaris groepen beginnend baij "\<80.000"
    en eindigend bij "\>160.000". De tussengelegen groepen beslaan steed
    ranges van 20.000. Aangenomen is dat dit jaarsalarissen zijn.

Vanuit deze dataset lijkt de skills kolom het meest relevant. Deze kan
namelijk gebruikt worden om de nederlandse vacatures te textminen. Dit
gebeurt na wat bewerkingen ook in
*".\\Supporting_code\\indeed_scraper.R"*. Dit wordt tijdens het
hoofdstuk modeling verder toegelicht

```{r read D001, eval=TRUE, results='hide'}
# kenmerken D001 dataset
df_indeed_kaggle <- read.csv(".\\Data_raw\\D001\\indeed_job_dataset.csv")

head(df_indeed_kaggle)
df_indeed_kaggle %>% summary()
df_indeed_kaggle %>% names() %>% length()
df_indeed_kaggle$Skill %>% unique() %>% length()
df_indeed_kaggle$Job_Title %>% unique() %>% length()
df_indeed_kaggle$Queried_Salary %>% unique()
df_indeed_kaggle$Job_Type %>% unique()
```

**D002:**

Zoals gesteld wordt deze dataset op basis van 1 file beschreven,
namelijk: *".\\Data_raw\\D002\\2022-03-08 scraped indeed data.csv"*. Dit
voorbeeld bestand bestaat uit:

-   328 rijen

-   8 kolommen (plus een index kolom)

-   6 character kolommen

-   177 functie titels

-   201 skill(combinaties)

Gemmideld staat (op het moment van scrapen) een post 22 dagen online.
Daarnaast zijn er 99 unieke salaris waarden bekend, van 157 vacatures is
het salaris onbekend. Verder is het euro (€) symbool niet goed vertaald
bij het scrapen en lijken er maand en jaar salarissen gemixed te zijn
(een korte search naar een vacature met een loon boven de €10.000,- op
indeed bevestigd dit). De dataset lijkt, zoals verwacht, niet verder
terug te gaan dan februari 2022 (2022-02-06) om precies te zijn.

```{r read D002, eval=TRUE, results='hide'}
# kenmerken D002 dataset
df_indeed_scraped <- read.csv(".\\Data_raw\\D002\\2022-03-08 scraped indeed data.csv")

df_indeed_scraped %>% summary()

print("number of unique jobs:")
df_indeed_scraped$job_title %>% unique() %>% length()

print("number of unique skill(s) and combinations:")
df_indeed_scraped$skills %>% unique() %>% length()

print("number of unique salaries:")
df_indeed_scraped$salary %>% unique() %>% length()

print("sample of salaries:")
df_indeed_scraped$salary %>% head(20)

print("listings without salary:")
sum(is.na(df_indeed_scraped$salary))

print("number of companies with job listings:")
df_indeed_scraped$Company %>% unique() %>% length()


# zoek naar specifieke salaris om de vacature op indeed te bekijken
print("URL of job listing with suspected year salary")
df_indeed_scraped %>%
  filter(salary =='ï¿½ 72.171') %>%
  .$job_link %>%
  .[1]


print("earliest listing date:")
df_indeed_scraped$listing_date %>% min(na.rm = TRUE)
```

### Explore the data

Hieronder wordt de data verkend. D001 is al een beetje geschoond en kan
hieronder makkelijk verkend worden. D002 bevat een ruwe data die niet
goed te gebruiken is. Hiervoor is het script
*'./supporting_code/Scraped_indeed_data_wrangler.R'* beschikbaar. Dit
script bevat functies om de data vanuit de scraper op te schonen zodat
er wel inzichten uit de data gehaald kunnen worden.

#### D001

Voor D001 wordt in dit onderdeel de verdeling bekeken voor het aantal
skills en salaris over de totale dataset en gesegmenteerd op baan type.

**Data Analist**

Wat gelijk opvalt aan deze dataset is dat de data analist de "minst
zware" functie lijkt. Er worden minder skills verwacht van een data
analist en het loon voor deze rol ligt ook doorgaans lager dan de andere
twee rollen.

**Data Engineer**

Het is gelijk duidelijk dat data engineers de minste vraag genieten maar
wel een zwaarder profiel moeten hebben. Het salaris van de data engineer
volgt ongeveer de verdeling van de data scientist. Wel valt op dat
ondanks de lagere hoeveelheid vacatures dat de data engineer het
zwaarste skill profiel dient te hebben.

**Data Scientist**

Naar data scientisten lijkt de hoogste vraag te zijn. Het skill profiel
van de data scientist is gemiddeld de verdeling neigt meer naar links
dan de data engineer. Ondanks dit lijkt de salaris verdeling gelijk te
zijn aan die verdeling van de data engineer.

**Andere inzichten**

Verder is in deze dataset te zien dat, wanneer er om meer skills
gevraagd wordt er een iets hoger salaris wordt geboden. Voor de hoogste
salaris groep lijkt dit echter niet te gelden. De aannamen (die nog
getoetst kan worden) is dat dit gaat om teamleiders of andere management
functies waar hard skills minder van belang zijn.

```{r D001 exploration, echo=FALSE}

kaggle_plots <- plot_kaggle_distribution(df_indeed_kaggle)
```

#### D002

D002 is minder "schoon" dan D001. Dit betekent dat er wat meer moet
gebeuren voor er een eerste EDA (exploratory Data Analysis) kan plaats
vinden. Met behulp van het script
*'./supporting_code/Scraped_indeed_data_wrangler.R'* kan de tot nu toe
binnengehaalde data worden gemerged en gecleaned. Ook voegen de functies
in dit script nieuwe kolommen toe zoals "skills_count" en een
levensthein ratio for de drie referentie functie type (analist,
engineer, scientist).

```{r D002, echo=FALSE}
# clean en verrijk indeed data met custom functies
df_indeed_cleaned <- clean_scraped_date(df_indeed_scraped)
df_indeed_final <- enrich_scraped_date(df_indeed_cleaned)

# visualiseer de loon verdeling
df_indeed_final %>%
    ggplot(aes(x= salary)) +
    geom_density(alpha=0.5) +
    labs(
        title="Verdeling maandsalaris",
        y= "frequentie",
        x= "Maandsalaris"
    ) +
    theme(
        plot.title=element_text(hjust=0.5)
    )


```

In bovenstaande afbeelding is nog niet heel veel af te lezen over de
dataset zelf. Maar een van de vragen die HoB stelt: "hoe verhoudt het
maandsalaris op de markt met het HoB maandsalaris?" Kan nu wel
inzichtelijk worden gemaakt. In onderstaande afbeelding worden zowel het
maandsalaris van jaar 1, jaar 2 als jaar 3 bij HoB toegevoegd aan de
grafiek. Ook kunnen we de mediaan de salarissen uit de dataset
toevoegen. Op deze manier kunnen we achterhalen op welke moment een HoB
consultant de meeste salarissen van Indeed zal inhalen. Dit blijkt in de
overgang van het 2de naar het 3de jaar.\

```{r}
plot_hob_salary_vs_indeed_salary_dist(df_indeed_final)
```
